!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e=e||self).gram=e.gram||{},e.gram.d3={}))}(this,(function(e){"use strict";var t=/[0-9a-zA-Z_@]+\b@*/,r=new RegExp("^"+t.source+"$"),n={__proto__:null,boolean:/true|false|TRUE|FALSE\b(?!@)/,hexadecimal:/-?0x(?:[0-9a-fA-F]+)\b(?!@)/,octal:/-?0(?:[0-7]+)\b(?!@)/,measurement:/-?(?:[0-9]|[1-9][0-9]+)(?:\.[0-9]+)?[a-zA-Z]+\b(?!@)/,decimal:/-?(?:[0-9]|[1-9][0-9]+)\.[0-9]+(?:[eE][-+]?[0-9]+)?\b(?!@)/,integer:/-?(?:[0-9]|[1-9][0-9]+)(?:[eE][-+]?[0-9]+)?\b(?!@)/,taggedString:/[a-zA-Z][0-9a-zA-Z_@]*`(?:\\[`bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^`\\])*`/,doubleQuotedString:/"(?:\\["bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^"\\])*"/,singleQuotedString:/'(?:\\['bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^'\\])*'/,tickedString:/`(?:\\[`bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^`\\])*`/,symbol:/[a-zA-Z_][0-9a-zA-Z_]*\b(?!@)/,identifier:t,isValidIdentifier:function(e){return e&&r.test(e)}},o=function(e){return!!e.type&&"path"===e.type},i=function(e){return o(e)&&"√∏"===e.id},s=function(e){return o(e)&&e.children&&0===e.children.length&&"√∏"!==e.id},a=function(e){return!!e.type&&!!e.value&&"property"!==e.type};function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function u(e){return Array.isArray(e)?e:e instanceof Function?u(e()):void 0===e?[]:[e]}var c=function(e,t){void 0===t&&(t={});var r=l({type:"path"},t.id&&{id:t.id},t.labels&&{labels:t.labels},t.record&&{record:t.record});if(void 0===e)return r.id&&"√∏"!==r.id?(r.children=[],r):(r.children=void 0,f);if(0===e.length)return"√∏"===r.id?f:(r.children=[],r);if(1===e.length){var n=e[0];return i(n)?(r.children=[],r):(r.children=[n],r)}if(2===e.length){if(t.kind&&"pair"!==t.kind&&s(e[0])&&s(e[1]))return r.kind=t.kind,r.children=[e[0],e[1]],r;if(i(e[0])&&i(e[1]))return r.kind=t.kind,r.children=[],r;r.children=[e[0],e[1]]}return r.kind=t.kind||"pair",r},f={type:"path",id:"√∏",labels:void 0,record:void 0,children:[]},p=function(e,t,r){return l({type:"path"},e&&{id:e},t&&{labels:t},r&&{record:r},{children:[]})},h=function(e,t,r,n,o){return l({type:"path",id:r},n&&{labels:n},o&&{record:o},{kind:t,children:e})},d=function(e){return{type:"string",value:e}},m=function e(t){return void 0===t.children||0===t.children.length?t:e(t.children[0])},y=function e(t){return void 0===t.children||0===t.children.length?t:e(t.children[t.children.length-1])},b=function e(t){if(s(t))return[t];if((r=t).type&&"seq"===r.type)return e(t.children);var r;if(Array.isArray(t)){var n=[],o=t.map(e).flat().reduce((function(e,t){return t.id?e.has(t.id)?e.set(t.id,Object.assign(e.get(t.id),t)):e.set(t.id,t):n.push(t),e}),new Map);return Array.from(o.values()).concat(n)}return e(t.children)},g=function e(t){return void 0===t||void 0===t.children||0===t.children.length?[]:2===t.children.length?[].concat(e(t.children[0]),void 0!==t.kind&&"pair"!==t.kind?[h([y(t.children[0]),m(t.children[1])],t.kind,t.id,t.labels,t.record)]:[],e(t.children[1])):t.children.reduce((function(t,r){return[].concat(t,e(r))}),[])},v="__missing_id__",w=function(e,t,r){return{id:e||v,labels:t||[],record:r||[]}},x=function(e,t,r,n,o){return{id:r||v,labels:n||[],record:o||[],source:e,target:t}},S=function(e){if(e)throw e},k=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},E=Object.prototype.hasOwnProperty,$=Object.prototype.toString,O=Object.defineProperty,P=Object.getOwnPropertyDescriptor,_=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===$.call(e)},A=function(e){if(!e||"[object Object]"!==$.call(e))return!1;var t,r=E.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&E.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!r&&!n)return!1;for(t in e);return void 0===t||E.call(e,t)},j=function(e,t){O&&"__proto__"===t.name?O(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},N=function(e,t){if("__proto__"===t){if(!E.call(e,t))return;if(P)return P(e,t).value}return e[t]},I=function e(){var t,r,n,o,i,s,a=arguments[0],l=1,u=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[1]||{},l=2),(null==a||"object"!=typeof a&&"function"!=typeof a)&&(a={});l<u;++l)if(null!=(t=arguments[l]))for(r in t)n=N(a,r),a!==(o=N(t,r))&&(c&&o&&(A(o)||(i=_(o)))?(i?(i=!1,s=n&&_(n)?n:[]):s=n&&A(n)?n:{},j(a,{name:r,newValue:e(c,s,o)})):void 0!==o&&j(a,{name:r,newValue:o}));return a},C=e=>{if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype},T=[].slice,L=function(e,t){var r;return function(){var t,i=T.call(arguments,0),s=e.length>i.length;s&&i.push(n);try{t=e.apply(null,i)}catch(e){if(s&&r)throw e;return n(e)}s||(t&&"function"==typeof t.then?t.then(o,n):t instanceof Error?n(t):o(t))};function n(){r||(r=!0,t.apply(null,arguments))}function o(e){n(null,e)}},R=B;B.wrap=L;var q=[].slice;function B(){var e=[],t={run:function(){var t=-1,r=q.call(arguments,0,-1),n=arguments[arguments.length-1];if("function"!=typeof n)throw new Error("Expected function as last argument, not "+n);function o(i){var s=e[++t],a=q.call(arguments,0),l=a.slice(1),u=r.length,c=-1;if(i)n(i);else{for(;++c<u;)null==l[c]&&(l[c]=r[c]);r=l,s?L(s,o).apply(null,r):n.apply(null,[null].concat(r))}}o.apply(null,[null].concat(r))},use:function(r){if("function"!=typeof r)throw new Error("Expected `fn` to be a function, not "+r);return e.push(r),t}};return t}var D={}.hasOwnProperty,G=function(e){return e&&"object"==typeof e?D.call(e,"position")||D.call(e,"type")?M(e.position):D.call(e,"start")||D.call(e,"end")?M(e):D.call(e,"line")||D.call(e,"column")?V(e):"":""};function V(e){return e&&"object"==typeof e||(e={}),F(e.line)+":"+F(e.column)}function M(e){return e&&"object"==typeof e||(e={}),V(e.start)+"-"+V(e.end)}function F(e){return e&&"number"==typeof e?e:1}var U=H;function z(){}z.prototype=Error.prototype;var Q=H.prototype=new z;function H(e,t,r){var n,o,i;"string"==typeof t&&(r=t,t=null),n=function(e){var t,r=[null,null];return"string"==typeof e&&(-1===(t=e.indexOf(":"))?r[1]=e:(r[0]=e.slice(0,t),r[1]=e.slice(t+1))),r}(r),o=G(t)||"1:1",i={start:{line:null,column:null},end:{line:null,column:null}},t&&t.position&&(t=t.position),t&&(t.start?(i=t,t=t.start):i.start=t),e.stack&&(this.stack=e.stack,e=e.message),this.message=e,this.name=o,this.reason=e,this.line=t?t.line:null,this.column=t?t.column:null,this.location=i,this.source=n[0],this.ruleId=n[1]}function J(e){var t,r;return K(e),t=47===e.charCodeAt(0),(r=function(e,t){for(var r,n,o="",i=0,s=-1,a=0,l=-1;++l<=e.length;){if(l<e.length)r=e.charCodeAt(l);else{if(47===r)break;r=47}if(47===r){if(s===l-1||1===a);else if(s!==l-1&&2===a){if(o.length<2||2!==i||46!==o.charCodeAt(o.length-1)||46!==o.charCodeAt(o.length-2))if(o.length>2){if((n=o.lastIndexOf("/"))!==o.length-1){n<0?(o="",i=0):i=(o=o.slice(0,n)).length-1-o.lastIndexOf("/"),s=l,a=0;continue}}else if(o.length){o="",i=0,s=l,a=0;continue}t&&(o=o.length?o+"/..":"..",i=2)}else o.length?o+="/"+e.slice(s+1,l):o=e.slice(s+1,l),i=l-s-1;s=l,a=0}else 46===r&&a>-1?a++:a=-1}return o}(e,!t)).length||t||(r="."),r.length&&47===e.charCodeAt(e.length-1)&&(r+="/"),t?"/"+r:r}function K(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}Q.file="",Q.name="",Q.reason="",Q.message="",Q.stack="",Q.fatal=null,Q.column=null,Q.line=null;var Z=function(e,t){var r,n,o,i,s=0,a=-1;if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');if(K(e),r=e.length,void 0===t||!t.length||t.length>e.length){for(;r--;)if(47===e.charCodeAt(r)){if(o){s=r+1;break}}else a<0&&(o=!0,a=r+1);return a<0?"":e.slice(s,a)}if(t===e)return"";for(n=-1,i=t.length-1;r--;)if(47===e.charCodeAt(r)){if(o){s=r+1;break}}else n<0&&(o=!0,n=r+1),i>-1&&(e.charCodeAt(r)===t.charCodeAt(i--)?i<0&&(a=r):(i=-1,a=n));return s===a?a=n:a<0&&(a=e.length),e.slice(s,a)},W=function(){for(var e,t=-1;++t<arguments.length;)K(arguments[t]),arguments[t]&&(e=void 0===e?arguments[t]:e+"/"+arguments[t]);return void 0===e?".":J(e)},Y=te,X={}.hasOwnProperty,ee=["history","path","basename","stem","extname","dirname"];function te(e){var t,r;if(e){if("string"==typeof e||k(e))e={contents:e};else if("message"in e&&"messages"in e)return e}else e={};if(!(this instanceof te))return new te(e);for(this.data={},this.messages=[],this.history=[],this.cwd="/",r=-1;++r<ee.length;)X.call(e,t=ee[r])&&(this[t]=e[t]);for(t in e)ee.indexOf(t)<0&&(this[t]=e[t])}function re(e,t){if(e&&e.indexOf("/")>-1)throw new Error("`"+t+"` cannot be a path: did not expect `/`")}function ne(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function oe(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}te.prototype.toString=function(e){return(this.contents||"").toString(e)},Object.defineProperty(te.prototype,"path",{get:function(){return this.history[this.history.length-1]},set:function(e){ne(e,"path"),this.path!==e&&this.history.push(e)}}),Object.defineProperty(te.prototype,"dirname",{get:function(){return"string"==typeof this.path?function(e){var t,r,n;if(K(e),!e.length)return".";for(t=-1,n=e.length;--n;)if(47===e.charCodeAt(n)){if(r){t=n;break}}else r||(r=!0);return t<0?47===e.charCodeAt(0)?"/":".":1===t&&47===e.charCodeAt(0)?"//":e.slice(0,t)}(this.path):void 0},set:function(e){oe(this.path,"dirname"),this.path=W(e||"",this.basename)}}),Object.defineProperty(te.prototype,"basename",{get:function(){return"string"==typeof this.path?Z(this.path):void 0},set:function(e){ne(e,"basename"),re(e,"basename"),this.path=W(this.dirname||"",e)}}),Object.defineProperty(te.prototype,"extname",{get:function(){return"string"==typeof this.path?function(e){var t,r,n,o=-1,i=0,s=-1,a=0;for(K(e),n=e.length;n--;)if(47!==(r=e.charCodeAt(n)))s<0&&(t=!0,s=n+1),46===r?o<0?o=n:1!==a&&(a=1):o>-1&&(a=-1);else if(t){i=n+1;break}return o<0||s<0||0===a||1===a&&o===s-1&&o===i+1?"":e.slice(o,s)}(this.path):void 0},set:function(e){if(re(e,"extname"),oe(this.path,"extname"),e){if(46!==e.charCodeAt(0))throw new Error("`extname` must start with `.`");if(e.indexOf(".",1)>-1)throw new Error("`extname` cannot contain multiple dots")}this.path=W(this.dirname,this.stem+(e||""))}}),Object.defineProperty(te.prototype,"stem",{get:function(){return"string"==typeof this.path?Z(this.path,this.extname):void 0},set:function(e){ne(e,"stem"),re(e,"stem"),this.path=W(this.dirname||"",e+(this.extname||""))}});var ie=Y;Y.prototype.message=function(e,t,r){var n=new U(e,t,r);return this.path&&(n.name=this.path+":"+n.name,n.file=this.path),n.fatal=!1,this.messages.push(n),n},Y.prototype.info=function(){var e=this.message.apply(this,arguments);return e.fatal=null,e},Y.prototype.fail=function(){var e=this.message.apply(this,arguments);throw e.fatal=!0,e};var se=ie,ae=function e(){var t=[],r=R(),n={},o=!1,i=-1;return s.data=function(e,t){return"string"==typeof e?2===arguments.length?(de("data",o),n[e]=t,s):ue.call(n,e)&&n[e]||null:e?(de("data",o),n=e,s):n},s.freeze=a,s.attachers=t,s.use=function(e){var r;if(de("use",o),null==e);else if("function"==typeof e)c.apply(null,arguments);else{if("object"!=typeof e)throw new Error("Expected usable value, not `"+e+"`");"length"in e?u(e):i(e)}return r&&(n.settings=I(n.settings||{},r)),s;function i(e){u(e.plugins),e.settings&&(r=I(r||{},e.settings))}function a(e){if("function"==typeof e)c(e);else{if("object"!=typeof e)throw new Error("Expected usable value, not `"+e+"`");"length"in e?c.apply(null,e):i(e)}}function u(e){var t,r;if(null==e);else{if("object"!=typeof e||!("length"in e))throw new Error("Expected a list of plugins, not `"+e+"`");for(t=e.length,r=-1;++r<t;)a(e[r])}}function c(e,r){var n=l(e);n?(C(n[1])&&C(r)&&(r=I(n[1],r)),n[1]=r):t.push(le.call(arguments))}},s.parse=function(e){var t,r=se(e);return a(),pe("parse",t=s.Parser),fe(t,"parse")?new t(String(r),r).parse():t(String(r),r)},s.stringify=function(e,t){var r,n=se(t);return a(),he("stringify",r=s.Compiler),me(e),fe(r,"compile")?new r(e,n).compile():r(e,n)},s.run=u,s.runSync=function(e,t){var r,n=!1;return u(e,t,(function(e,t){n=!0,S(e),r=t})),ye("runSync","run",n),r},s.process=c,s.processSync=function(e){var t,r=!1;return a(),pe("processSync",s.Parser),he("processSync",s.Compiler),c(t=se(e),(function(e){r=!0,S(e)})),ye("processSync","process",r),t},s;function s(){for(var r=e(),o=t.length,i=-1;++i<o;)r.use.apply(null,t[i]);return r.data(I(!0,{},n)),r}function a(){var e,n,a,l;if(o)return s;for(;++i<t.length;)n=(e=t[i])[0],!1!==(a=e[1])&&(!0===a&&(e[1]=void 0),"function"==typeof(l=n.apply(s,e.slice(1)))&&r.use(l));return o=!0,i=Infinity,s}function l(e){for(var r,n=t.length,o=-1;++o<n;)if((r=t[o])[0]===e)return r}function u(e,t,n){if(me(e),a(),n||"function"!=typeof t||(n=t,t=null),!n)return new Promise(o);function o(o,i){r.run(e,se(t),(function(t,r,s){r=r||e,t?i(t):o?o(r):n(null,r,s)}))}o(null,n)}function c(e,t){if(a(),pe("process",s.Parser),he("process",s.Compiler),!t)return new Promise(r);function r(r,n){var o=se(e);ce.run(s,{file:o},(function(e){e?n(e):r?r(o):t(null,o)}))}r(null,t)}}().freeze(),le=[].slice,ue={}.hasOwnProperty,ce=R().use((function(e,t){t.tree=e.parse(t.file)})).use((function(e,t,r){e.run(t.tree,t.file,(function(e,n,o){e?r(e):(t.tree=n,t.file=o,r())}))})).use((function(e,t){var r=e.stringify(t.tree,t.file),n=t.file;null==r||("string"==typeof r||k(r)?n.contents=r:n.result=r)}));function fe(e,t){return"function"==typeof e&&e.prototype&&(function(e){var t;for(t in e)return!0;return!1}(e.prototype)||t in e.prototype)}function pe(e,t){if("function"!=typeof t)throw new Error("Cannot `"+e+"` without `Parser`")}function he(e,t){if("function"!=typeof t)throw new Error("Cannot `"+e+"` without `Compiler`")}function de(e,t){if(t)throw new Error("Cannot invoke `"+e+"` on a frozen processor.\nCreate a new processor first, by invoking it: use `processor()` instead of `processor`.")}function me(e){if(!e||"string"!=typeof e.type)throw new Error("Expected node, got `"+e+"`")}function ye(e,t,r){if(!r)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}var be="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ge(e,t){return e(t={exports:{}},t.exports),t.exports}function ve(e){return e&&e.default||e}var we=ge((function(e){var t,r;t=be,r=function(){function e(t,r,n){return this.id=++e.highestId,this.name=t,this.symbols=r,this.postprocess=n,this}function t(e,t,r,n){this.rule=e,this.dot=t,this.reference=r,this.data=[],this.wantedBy=n,this.isComplete=this.dot===e.symbols.length}function r(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function n(e,t){this.rules=e,this.start=t||this.rules[0].name;var r=this.byName={};this.rules.forEach((function(e){r.hasOwnProperty(e.name)||(r[e.name]=[]),r[e.name].push(e)}))}function o(){this.reset("")}function i(e,t,i){if(e instanceof n){var s=e;i=t}else s=n.fromCompiled(e,t);for(var a in this.grammar=s,this.options={keepHistory:!1,lexer:s.lexer||new o},i||{})this.options[a]=i[a];this.lexer=this.options.lexer,this.lexerState=void 0;var l=new r(s,0);this.table=[l],l.wants[s.start]=[],l.predict(s.start),l.process(),this.current=0}function s(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return e.toString();if(e.type)return"%"+e.type;if(e.test)return"<"+String(e.test)+">";throw new Error("Unknown symbol type: "+e)}}return e.highestId=0,e.prototype.toString=function(e){var t=void 0===e?this.symbols.map(s).join(" "):this.symbols.slice(0,e).map(s).join(" ")+" ‚óè "+this.symbols.slice(e).map(s).join(" ");return this.name+" ‚Üí "+t},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var r=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return r.left=this,r.right=e,r.isComplete&&(r.data=r.build(),r.right=void 0),r},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,i.fail))},r.prototype.process=function(e){for(var t=this.states,r=this.wants,n=this.completed,o=0;o<t.length;o++){var s=t[o];if(s.isComplete){if(s.finish(),s.data!==i.fail){for(var a=s.wantedBy,l=a.length;l--;)this.complete(a[l],s);s.reference===this.index&&(this.completed[u=s.rule.name]=this.completed[u]||[]).push(s)}}else{var u;if("string"!=typeof(u=s.rule.symbols[s.dot])){this.scannable.push(s);continue}if(r[u]){if(r[u].push(s),n.hasOwnProperty(u)){var c=n[u];for(l=0;l<c.length;l++)this.complete(s,c[l])}}else r[u]=[s],this.predict(u)}}},r.prototype.predict=function(e){for(var r=this.grammar.byName[e]||[],n=0;n<r.length;n++){var o=new t(r[n],0,this.index,this.wants[e]);this.states.push(o)}},r.prototype.complete=function(e,t){var r=e.nextState(t);this.states.push(r)},n.fromCompiled=function(t,r){var o=t.Lexer;t.ParserStart&&(r=t.ParserStart,t=t.ParserRules);var i=new n(t=t.map((function(t){return new e(t.name,t.symbols,t.postprocess)})),r);return i.lexer=o,i},o.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},o.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},o.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},o.prototype.formatError=function(e,t){var r=this.buffer;if("string"==typeof r){var n=r.split("\n").slice(Math.max(0,this.line-5),this.line),o=r.indexOf("\n",this.index);-1===o&&(o=r.length);var i=this.index-this.lastLineBreak,s=String(this.line).length;return t+=" at line "+this.line+" col "+i+":\n\n",(t+=n.map((function(e,t){return a(this.line-n.length+t+1,s)+" "+e}),this).join("\n"))+"\n"+a("",s+i)+"^\n"}return t+" at index "+(this.index-1);function a(e,t){var r=String(e);return Array(t-r.length+1).join(" ")+r}},i.fail={},i.prototype.feed=function(e){var t,n=this.lexer;for(n.reset(e,this.lexerState);;){try{if(!(t=n.next()))break}catch(e){var i=new r(this.grammar,this.current+1);throw this.table.push(i),(l=new Error(this.reportLexerError(e))).offset=this.current,l.token=e.token,l}var s=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var a=this.current+1;i=new r(this.grammar,a),this.table.push(i);for(var l,u=void 0!==t.text?t.text:t.value,c=n.constructor===o?t.value:t,f=s.scannable,p=f.length;p--;){var h=f[p],d=h.rule.symbols[h.dot];if(d.test?d.test(c):d.type?d.type===t.type:d.literal===u){var m=h.nextState({data:c,token:t,isToken:!0,reference:a-1});i.states.push(m)}}if(i.process(),0===i.states.length)throw(l=new Error(this.reportError(t))).offset=this.current,l.token=t,l;this.options.keepHistory&&(s.lexerState=n.save()),this.current++}return s&&(this.lexerState=n.save()),this.results=this.finish(),this},i.prototype.reportLexerError=function(e){var t,r,n=e.token;return n?(t="input "+JSON.stringify(n.text[0])+" (lexer error)",r=this.lexer.formatError(n,"Syntax error")):(t="input (lexer error)",r=e.message),this.reportErrorCommon(r,t)},i.prototype.reportError=function(e){var t=(e.type?e.type+" token: ":"")+JSON.stringify(void 0!==e.value?e.value:e),r=this.lexer.formatError(e,"Syntax error");return this.reportErrorCommon(r,t)},i.prototype.reportErrorCommon=function(e,t){var r=[];r.push(e);var n=this.table[this.table.length-2],o=n.states.filter((function(e){var t=e.rule.symbols[e.dot];return t&&"string"!=typeof t}));return 0===o.length?(r.push("Unexpected "+t+". I did not expect any more input. Here is the state of my parse table:\n"),this.displayStateStack(n.states,r)):(r.push("Unexpected "+t+". Instead, I was expecting to see one of the following:\n"),o.map((function(e){return this.buildFirstStateStack(e,[])||[e]}),this).forEach((function(e){var t=e[0],n=this.getSymbolDisplay(t.rule.symbols[t.dot]);r.push("A "+n+" based on:"),this.displayStateStack(e,r)}),this)),r.push(""),r.join("\n")},i.prototype.displayStateStack=function(e,t){for(var r,n=0,o=0;o<e.length;o++){var i=e[o],s=i.rule.toString(i.dot);s===r?n++:(n>0&&t.push("    ^ "+n+" more lines identical to this"),n=0,t.push("    "+s)),r=s}},i.prototype.getSymbolDisplay=function(e){return function(e){var t=typeof e;if("string"===t)return e;if("object"===t){if(e.literal)return JSON.stringify(e.literal);if(e instanceof RegExp)return"character matching "+e;if(e.type)return e.type+" token";if(e.test)return"token matching "+String(e.test);throw new Error("Unknown symbol type: "+e)}}(e)},i.prototype.buildFirstStateStack=function(e,t){if(-1!==t.indexOf(e))return null;if(0===e.wantedBy.length)return[e];var r=e.wantedBy[0],n=[e].concat(t),o=this.buildFirstStateStack(r,n);return null===o?null:[e].concat(o)},i.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},i.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},i.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},i.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach((function(r){r.rule.name===t&&r.dot===r.rule.symbols.length&&0===r.reference&&r.data!==i.fail&&e.push(r)})),e.map((function(e){return e.data}))},{Parser:i,Grammar:n,Rule:e}},e.exports?e.exports=r():t.nearley=r()}));function xe(){return(xe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Se(e){return e[0]}var ke=ge((function(e){var t,r;t=be,r=function(){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,r="boolean"==typeof(new RegExp).sticky;function n(e){return e&&"[object RegExp]"===t.call(e)}function o(e){return e&&"object"==typeof e&&!n(e)&&!Array.isArray(e)}function i(e){return e.length?"(?:"+e.map((function(e){return"(?:"+e+")"})).join("|")+")":"(?!)"}function s(e){if("string"==typeof e)return"(?:"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+")";if(n(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("Not a pattern: "+e)}function a(t,r){if(o(r)||(r={match:r}),r.include)throw new Error("Matching rules cannot also include states");var i={defaultType:t,lineBreaks:!!r.error||!!r.fallback,pop:!1,next:null,push:null,error:!1,fallback:!1,value:null,type:null,shouldThrow:!1};for(var s in r)e.call(r,s)&&(i[s]=r[s]);if("string"==typeof i.type&&t!==i.type)throw new Error("Type transform cannot be a string (type '"+i.type+"' for token '"+t+"')");var a=i.match;return i.match=Array.isArray(a)?a:a?[a]:[],i.match.sort((function(e,t){return n(e)&&n(t)?0:n(t)?-1:n(e)?1:t.length-e.length})),i}function l(e){return Array.isArray(e)?function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(n.include)for(var o=[].concat(n.include),i=0;i<o.length;i++)t.push({include:o[i]});else{if(!n.type)throw new Error("Rule has no type: "+JSON.stringify(n));t.push(a(n.type,n))}}return t}(e):function(e){for(var t=Object.getOwnPropertyNames(e),r=[],n=0;n<t.length;n++){var i=t[n],s=[].concat(e[i]);if("include"!==i){var l=[];s.forEach((function(e){o(e)?(l.length&&r.push(a(i,l)),r.push(a(i,e)),l=[]):l.push(e)})),l.length&&r.push(a(i,l))}else for(var u=0;u<s.length;u++)r.push({include:s[u]})}return r}(e)}var u=a("error",{lineBreaks:!0,shouldThrow:!0});function c(e,t){for(var o=null,a=Object.create(null),l=!0,c=null,f=[],p=[],h=0;h<e.length;h++)e[h].fallback&&(l=!1);for(h=0;h<e.length;h++){var d=e[h];if(d.include)throw new Error("Inheritance is not allowed in stateless lexers");if(d.error||d.fallback){if(o)throw!d.fallback==!o.fallback?new Error("Multiple "+(d.fallback?"fallback":"error")+" rules not allowed (for token '"+d.defaultType+"')"):new Error("fallback and error are mutually exclusive (for token '"+d.defaultType+"')");o=d}var m=d.match.slice();if(l)for(;m.length&&"string"==typeof m[0]&&1===m[0].length;)a[m.shift().charCodeAt(0)]=d;if(d.pop||d.push||d.next){if(!t)throw new Error("State-switching options are not allowed in stateless lexers (for token '"+d.defaultType+"')");if(d.fallback)throw new Error("State-switching options are not allowed on fallback tokens (for token '"+d.defaultType+"')")}if(0!==m.length){l=!1,f.push(d);for(var y=0;y<m.length;y++){var b=m[y];if(n(b))if(null===c)c=b.unicode;else if(c!==b.unicode&&!1===d.fallback)throw new Error("If one rule is /u then all must be")}var g=i(m.map(s)),v=new RegExp(g);if(v.test(""))throw new Error("RegExp matches empty string: "+v);if(new RegExp("|"+g).exec("").length-1>0)throw new Error("RegExp has capture groups: "+v+"\nUse (?: ‚Ä¶ ) instead");if(!d.lineBreaks&&v.test("\n"))throw new Error("Rule should declare lineBreaks: "+v);p.push("("+g+")")}}var w=o&&o.fallback,x=r&&!w?"ym":"gm",S=r||w?"":"|";return!0===c&&(x+="u"),{regexp:new RegExp(i(p)+S,x),groups:f,fast:a,error:o||u}}function f(e,t,r){var n=e&&(e.push||e.next);if(n&&!r[n])throw new Error("Missing state '"+n+"' (in token '"+e.defaultType+"' of state '"+t+"')");if(e&&e.pop&&1!=+e.pop)throw new Error("pop must be 1 (in token '"+e.defaultType+"' of state '"+t+"')")}var p=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};p.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.queuedToken=t?t.queuedToken:null,this.queuedThrow=t?t.queuedThrow:null,this.setState(t?t.state:this.startState),this.stack=t&&t.stack?t.stack.slice():[],this},p.prototype.save=function(){return{line:this.line,col:this.col,state:this.state,stack:this.stack.slice(),queuedToken:this.queuedToken,queuedThrow:this.queuedThrow}},p.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error,this.re=t.regexp,this.fast=t.fast}},p.prototype.popState=function(){this.setState(this.stack.pop())},p.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)};var h=r?function(e,t){return e.exec(t)}:function(e,t){var r=e.exec(t);return 0===r[0].length?null:r};function d(){return this.value}if(p.prototype._getGroup=function(e){for(var t=this.groups.length,r=0;r<t;r++)if(void 0!==e[r+1])return this.groups[r];throw new Error("Cannot find token type for matched text")},p.prototype.next=function(){var e=this.index;if(this.queuedGroup){var t=this._token(this.queuedGroup,this.queuedText,e);return this.queuedGroup=null,this.queuedText="",t}var r=this.buffer;if(e!==r.length){if(s=this.fast[r.charCodeAt(e)])return this._token(s,r.charAt(e),e);var n=this.re;n.lastIndex=e;var o=h(n,r),i=this.error;if(null==o)return this._token(i,r.slice(e,r.length),e);var s=this._getGroup(o),a=o[0];return i.fallback&&o.index!==e?(this.queuedGroup=s,this.queuedText=a,this._token(i,r.slice(e,o.index),e)):this._token(s,a,e)}},p.prototype._token=function(e,t,r){var n=0;if(e.lineBreaks){var o=/\n/g,i=1;if("\n"===t)n=1;else for(;o.exec(t);)n++,i=o.lastIndex}var s={type:"function"==typeof e.type&&e.type(t)||e.defaultType,value:"function"==typeof e.value?e.value(t):t,text:t,toString:d,offset:r,lineBreaks:n,line:this.line,col:this.col},a=t.length;if(this.index+=a,this.line+=n,0!==n?this.col=a-i+1:this.col+=a,e.shouldThrow)throw new Error(this.formatError(s,"invalid syntax"));return e.pop?this.popState():e.push?this.pushState(e.push):e.next&&this.setState(e.next),s},"undefined"!=typeof Symbol&&Symbol.iterator){var m=function(e){this.lexer=e};m.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},m.prototype[Symbol.iterator]=function(){return this},p.prototype[Symbol.iterator]=function(){return new m(this)}}return p.prototype.formatError=function(e,t){if(null==e){var r=this.buffer.slice(this.index);e={text:r,offset:this.index,lineBreaks:-1===r.indexOf("\n")?0:1,line:this.line,col:this.col}}var n=Math.max(0,e.offset-e.col+1),o=e.lineBreaks?e.text.indexOf("\n"):e.text.length,i=this.buffer.substring(n,e.offset+o);return t+=" at line "+e.line+" col "+e.col+":\n\n",(t+="  "+i+"\n")+"  "+Array(e.col).join(" ")+"^"},p.prototype.clone=function(){return new p(this.states,this.state)},p.prototype.has=function(e){return!0},{compile:function(e){var t=c(l(e));return new p({start:t},"start")},states:function(e,t){var r=e.$all?l(e.$all):[];delete e.$all;var n=Object.getOwnPropertyNames(e);t||(t=n[0]);for(var o=Object.create(null),i=0;i<n.length;i++)o[v=n[i]]=l(e[v]).concat(r);for(i=0;i<n.length;i++)for(var s=o[v=n[i]],a=Object.create(null),u=0;u<s.length;u++){var h=s[u];if(h.include){var d=[u,1];if(h.include!==v&&!a[h.include]){a[h.include]=!0;var m=o[h.include];if(!m)throw new Error("Cannot include nonexistent state '"+h.include+"' (in state '"+v+"')");for(var y=0;y<m.length;y++){var b=m[y];-1===s.indexOf(b)&&d.push(b)}}s.splice.apply(s,d),u--}}var g=Object.create(null);for(i=0;i<n.length;i++){var v;g[v=n[i]]=c(o[v],!0)}for(i=0;i<n.length;i++){var w=n[i],x=g[w],S=x.groups;for(u=0;u<S.length;u++)f(S[u],w,g);var k=Object.getOwnPropertyNames(x.fast);for(u=0;u<k.length;u++)f(x.fast[k[u]],w,g)}return new p(g,t)},error:Object.freeze({error:!0}),fallback:Object.freeze({fallback:!0}),keywords:function(e){for(var t=Object.create(null),r=Object.create(null),n=Object.getOwnPropertyNames(e),o=0;o<n.length;o++){var i=n[o],s=e[i];(Array.isArray(s)?s:[s]).forEach((function(e){if((r[e.length]=r[e.length]||[]).push(e),"string"!=typeof e)throw new Error("keyword must be string (in keyword '"+i+"')");t[e]=i}))}function a(e){return JSON.stringify(e)}var l="";for(var u in l+="switch (value.length) {\n",r)l+="case "+u+":\n",l+="switch (value) {\n",r[u].forEach((function(e){var r=t[e];l+="case "+a(e)+": return "+a(r)+"\n"})),l+="}\n";return l+="}\n",Function("value",l)}}},e.exports?e.exports=r():t.moo=r()})).compile({whitespace:{match:/\s+/,lineBreaks:!0},lineComment:{match:/\/\/.*?\n?$/},hexadecimal:n.hexadecimal,octal:n.octal,measurement:n.measurement,decimal:n.decimal,integer:n.integer,taggedString:{match:n.taggedString},boolean:["true","TRUE","True","false","FALSE","False"],symbol:n.symbol,identifier:n.identifier,doubleQuotedString:{match:n.doubleQuotedString,value:function(e){return e.slice(1,-1)}},singleQuotedString:{match:n.singleQuotedString,value:function(e){return e.slice(1,-1)}},tickedString:{match:n.tickedString,value:function(e){return e.slice(1,-1)}},"--\x3e":"--\x3e","--":"--","<--":"<--","-[]->":"-[]->","-[]-":"-[]-","<-[]-":"<-[]-","<-[":"<-[","]->":"]->","-[":"-[","]-":"]-","{":"{","}":"}","[":"[","]":"]","(":"(",")":")",",":",",":":":","`":"`","'":"'","√∏":"√∏"}),Ee=function(){return null},$e=function(e){return e[0].text},Oe={Lexer:ke,ParserRules:[{name:"GramSeq$ebnf$1$subexpression$1",symbols:["Path","_"],postprocess:function(e){return e[0]}},{name:"GramSeq$ebnf$1",symbols:["GramSeq$ebnf$1$subexpression$1"]},{name:"GramSeq$ebnf$1$subexpression$2",symbols:["Path","_"],postprocess:function(e){return e[0]}},{name:"GramSeq$ebnf$1",symbols:["GramSeq$ebnf$1","GramSeq$ebnf$1$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"GramSeq$ebnf$2",symbols:["EOL"],postprocess:Se},{name:"GramSeq$ebnf$2",symbols:[],postprocess:function(){return null}},{name:"GramSeq",symbols:["GramSeq$ebnf$1","GramSeq$ebnf$2"],postprocess:function(e){var t;return void 0===t&&(t=1),l({type:"seq",id:void 0},void 0,void 0,{children:u(e[0].flat(t).filter((function(e){return null!==e})))})}},{name:"Path",symbols:["NodePattern"],postprocess:Se},{name:"Path",symbols:["PathComposition"],postprocess:Se},{name:"Path",symbols:["PathPair"],postprocess:Se},{name:"NodePattern",symbols:["Node","_","Edge","_","NodePattern"],postprocess:function(e){var t=e[2];return c([e[0],e[4]],{kind:t.kind,id:t.id,labels:t.labels,record:t.record})}},{name:"NodePattern",symbols:["Node"],postprocess:Se},{name:"Node",symbols:[{literal:"("},"_","Attributes","_",{literal:")"}],postprocess:function(e){var t=e[2];return p(t.id,t.labels,t.record)}},{name:"Edge",symbols:[{literal:"-["},"_","Attributes",{literal:"]->"}],postprocess:function(e){return xe({kind:"right"},e[2])}},{name:"Edge",symbols:[{literal:"-["},"_","Attributes",{literal:"]-"}],postprocess:function(e){return xe({kind:"either"},e[2])}},{name:"Edge",symbols:[{literal:"<-["},"_","Attributes",{literal:"]-"}],postprocess:function(e){return xe({kind:"left"},e[2])}},{name:"Edge",symbols:[{literal:"-[]->"}],postprocess:function(){return{kind:"right"}}},{name:"Edge",symbols:[{literal:"-[]-"}],postprocess:function(){return{kind:"either"}}},{name:"Edge",symbols:[{literal:"<-[]-"}],postprocess:function(){return{kind:"left"}}},{name:"Edge",symbols:[{literal:"--\x3e"}],postprocess:function(){return{kind:"right"}}},{name:"Edge",symbols:[{literal:"--"}],postprocess:function(){return{kind:"either"}}},{name:"Edge",symbols:[{literal:"<--"}],postprocess:function(){return{kind:"left"}}},{name:"PathComposition",symbols:["PathPoint"],postprocess:Se},{name:"PathComposition",symbols:["PathAnnotation"],postprocess:Se},{name:"PathComposition",symbols:["PathExpression"],postprocess:Se},{name:"PathPoint",symbols:[{literal:"["},"_","Attributes","_",{literal:"]"}],postprocess:function(e){var t=e[2];return(t.id||t.labels||t.record)&&"√∏"!==t.id?p(t.id,t.labels,t.record):f}},{name:"PathAnnotation",symbols:[{literal:"["},"_","Attributes","_","Path",{literal:"]"}],postprocess:function(e){var t=e[2];return c([e[4]],{id:t.id,labels:t.labels,record:t.record})}},{name:"PathExpression$ebnf$1",symbols:["Kind"],postprocess:Se},{name:"PathExpression$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"PathExpression",symbols:[{literal:"["},"_","Attributes","_","PathExpression$ebnf$1","_","Path","_","Path","_",{literal:"]"}],postprocess:function(e){var t=e[2];return c([e[6],e[8]],{kind:e[4],id:t.id,labels:t.labels,record:t.record})}},{name:"PathPair$subexpression$1",symbols:["NodePattern"]},{name:"PathPair$subexpression$1",symbols:["PathComposition"]},{name:"PathPair",symbols:["PathPair$subexpression$1","_",{literal:","},"_","Path"],postprocess:function(e){return function(e,t,r,n,o){return l({type:"path",kind:"pair",id:void 0},void 0,void 0,{children:t})}(0,[e[0][0],e[4]])}},{name:"Kind",symbols:[{literal:","}],postprocess:function(){return"pair"}},{name:"Kind",symbols:[{literal:"--\x3e"}],postprocess:function(){return"right"}},{name:"Kind",symbols:[{literal:"--"}],postprocess:function(){return"either"}},{name:"Kind",symbols:[{literal:"<--"}],postprocess:function(){return"left"}},{name:"Attributes$ebnf$1",symbols:["Identity"],postprocess:Se},{name:"Attributes$ebnf$1",symbols:[],postprocess:function(){return null}},{name:"Attributes$ebnf$2$subexpression$1",symbols:["_","LabelList"],postprocess:function(e){return e[1]}},{name:"Attributes$ebnf$2",symbols:["Attributes$ebnf$2$subexpression$1"],postprocess:Se},{name:"Attributes$ebnf$2",symbols:[],postprocess:function(){return null}},{name:"Attributes$ebnf$3$subexpression$1",symbols:["_","Record"],postprocess:function(e){return e[1]}},{name:"Attributes$ebnf$3",symbols:["Attributes$ebnf$3$subexpression$1"],postprocess:Se},{name:"Attributes$ebnf$3",symbols:[],postprocess:function(){return null}},{name:"Attributes",symbols:["Attributes$ebnf$1","Attributes$ebnf$2","Attributes$ebnf$3"],postprocess:function(e){return{id:e[0],labels:e[1],record:e[2]}}},{name:"LabelList$ebnf$1",symbols:["Label"]},{name:"LabelList$ebnf$1",symbols:["LabelList$ebnf$1","Label"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"LabelList",symbols:["LabelList$ebnf$1"],postprocess:function(e){return e[0]}},{name:"Label",symbols:[{literal:":"},"Symbol"],postprocess:function(e){return e[1]}},{name:"Identity",symbols:[ke.has("identifier")?{type:"identifier"}:identifier],postprocess:$e},{name:"Identity",symbols:[{literal:"√∏"}],postprocess:$e},{name:"Identity",symbols:[ke.has("symbol")?{type:"symbol"}:symbol],postprocess:$e},{name:"Identity",symbols:[ke.has("integer")?{type:"integer"}:integer],postprocess:$e},{name:"Identity",symbols:[ke.has("octal")?{type:"octal"}:octal],postprocess:$e},{name:"Identity",symbols:[ke.has("hexadecimal")?{type:"hexadecimal"}:hexadecimal],postprocess:$e},{name:"Identity",symbols:[ke.has("measurement")?{type:"measurement"}:measurement],postprocess:$e},{name:"Identity",symbols:[ke.has("tickedString")?{type:"tickedString"}:tickedString],postprocess:function(e){return e[0].text.slice(1,-1)}},{name:"Symbol",symbols:[ke.has("symbol")?{type:"symbol"}:symbol],postprocess:$e},{name:"Symbol",symbols:[ke.has("tickedString")?{type:"tickedString"}:tickedString],postprocess:function(e){return e[0].text.slice(1,-1)}},{name:"Record",symbols:[{literal:"{"},"_",{literal:"}"}],postprocess:Ee},{name:"Record$ebnf$1",symbols:[]},{name:"Record$ebnf$1$subexpression$1",symbols:["_",{literal:","},"_","Property"]},{name:"Record$ebnf$1",symbols:["Record$ebnf$1","Record$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"Record",symbols:[{literal:"{"},"_","Property","Record$ebnf$1","_",{literal:"}"}],postprocess:function(e){return[e[2]].concat(e[3].map((function(e){return e[3]})))}},{name:"Property",symbols:["Symbol","_",{literal:":"},"_","Value"],postprocess:function(e){return{type:"property",name:e[0],value:e[4]}}},{name:"Value",symbols:["StringLiteral"],postprocess:Se},{name:"Value",symbols:["NumericLiteral"],postprocess:Se},{name:"Value",symbols:[ke.has("boolean")?{type:"boolean"}:boolean],postprocess:function(e){return{type:"boolean",value:JSON.parse(e[0].value.toLowerCase())?"true":"false"}}},{name:"Value$ebnf$1",symbols:[]},{name:"Value$ebnf$1$subexpression$1",symbols:["_",{literal:","},"_","Value"]},{name:"Value$ebnf$1",symbols:["Value$ebnf$1","Value$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"Value",symbols:[{literal:"["},"_","Value","Value$ebnf$1",{literal:"]"}],postprocess:function(e){return[e[2]].concat(e[3].map((function(e){return e[3]})))}},{name:"StringLiteral",symbols:[ke.has("singleQuotedString")?{type:"singleQuotedString"}:singleQuotedString],postprocess:function(e){return d(e[0].value)}},{name:"StringLiteral",symbols:[ke.has("doubleQuotedString")?{type:"doubleQuotedString"}:doubleQuotedString],postprocess:function(e){return d(e[0].value)}},{name:"StringLiteral",symbols:[ke.has("tickedString")?{type:"tickedString"}:tickedString],postprocess:function(e){return d(e[0].value)}},{name:"StringLiteral",symbols:[ke.has("taggedString")?{type:"taggedString"}:taggedString],postprocess:function(e){var t=function(e){var t=e.match(/([^`]+)`(.+)`$/);if(null==t)throw Error("Malformed tagged string: "+e);return{tag:t[1],value:t[2]}}(e[0].value);return{type:"tagged",value:t.value,tag:t.tag}}},{name:"NumericLiteral",symbols:[ke.has("integer")?{type:"integer"}:integer],postprocess:function(e){return{type:"integer",value:String(e[0].value)}}},{name:"NumericLiteral",symbols:[ke.has("decimal")?{type:"decimal"}:decimal],postprocess:function(e){return{type:"decimal",value:String(e[0].value)}}},{name:"NumericLiteral",symbols:[ke.has("hexadecimal")?{type:"hexadecimal"}:hexadecimal],postprocess:function(e){return{type:"hexadecimal",value:"number"==typeof(t=e[0].value)?t.toString(16):t};var t}},{name:"NumericLiteral",symbols:[ke.has("octal")?{type:"octal"}:octal],postprocess:function(e){return{type:"octal",value:"number"==typeof(t=e[0].value)?t.toString(8):t};var t}},{name:"NumericLiteral",symbols:[ke.has("measurement")?{type:"measurement"}:measurement],postprocess:function(e){var t,r=function(e){var t=e.match(/(-?[0-9.]+)([a-zA-Z]+)/);if(null==t)throw Error("Malformed measurement : "+e);return{value:t[1],unit:t[2]}}(e[0].value);return t=r.unit,{type:"measurement",value:String(r.value),unit:t}}},{name:"_",symbols:[]},{name:"_",symbols:[ke.has("whitespace")?{type:"whitespace"}:whitespace],postprocess:Ee},{name:"Comment",symbols:[ke.has("lineComment")?{type:"lineComment"}:lineComment],postprocess:Ee},{name:"EOL",symbols:[{literal:"\n"}],postprocess:Ee}],ParserStart:"GramSeq"},Pe=function(e,t){var r,n,o=new we.Parser(we.Grammar.fromCompiled(Oe));try{var i=o.feed(e);if(void 0===i.results[0]&&i.lexerState){var s={line:(n=i.lexerState).line,column:n.col};t.fail("Incomplete parse.",s)}return i.results.length>1&&t.info("[WARN] parsing is ambiguous"),i.results[0]||{type:"error"}}catch(e){var a=e.token?{line:(r=e.token).line,column:r.col}:{line:0,column:0};t.fail(e.message,a)}},_e=function(){this.Parser=Pe};function Ae(){return!0}var je=Ne;function Ne(e,t,r,n){var o,i;"function"==typeof t&&"function"!=typeof r&&(n=r,r=t,t=null),i=function e(t){if(null==t)return Ae;if("string"==typeof t)return function(e){return function(t){return Boolean(t&&t.type===e)}}(t);if("object"==typeof t)return"length"in t?function(t){for(var r=[],n=-1;++n<t.length;)r[n]=e(t[n]);return function(){for(var e=-1;++e<r.length;)if(r[e].apply(this,arguments))return!0;return!1}}(t):function(e){return function(t){var r;for(r in e)if(t[r]!==e[r])return!1;return!0}}(t);if("function"==typeof t)return t;throw new Error("Expected function, string, or object as test")}(t),o=n?-1:1,function e(s,a,l){var u,c="object"==typeof s&&null!==s?s:{};return"string"==typeof c.type&&(f.displayName="node ("+c.type+((u="string"==typeof c.tagName?c.tagName:"string"==typeof c.name?c.name:void 0)?"<"+u+">":"")+")"),f;function f(){var u,c,f=l.concat(s),p=[];if((!t||i(s,a,l[l.length-1]||null))&&!1===(p=function(e){return null!==e&&"object"==typeof e&&"length"in e?e:"number"==typeof e?[!0,e]:[e]}(r(s,l)))[0])return p;if(s.children&&"skip"!==p[0])for(c=(n?s.children.length:-1)+o;c>-1&&c<s.children.length;){if(!1===(u=e(s.children[c],c,f)())[0])return u;c="number"==typeof u[1]?u[1]:c+o}return p}}(e,null,[])()}Ne.CONTINUE=!0,Ne.SKIP="skip",Ne.EXIT=!1;var Ie=Le,Ce=je.SKIP,Te=je.EXIT;function Le(e,t,r,n){"function"==typeof t&&"function"!=typeof r&&(n=r,r=t,t=null),je(e,t,(function(e,t){var n=t[t.length-1],o=n?n.children.indexOf(e):null;return r(e,o,n)}),n)}Le.CONTINUE=je.CONTINUE,Le.SKIP=Ce,Le.EXIT=Te;let Re=e=>crypto.getRandomValues(new Uint8Array(e));function qe(){return(qe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Be={base2:"01",dieBase6:"‚öÄ‚öÅ‚öÇ‚öÉ‚öÑ‚öÖ",base8:"01234567",base10:"0123456789",astrologyBase12:"‚ôàÔ∏é‚ôâÔ∏é‚ôäÔ∏é‚ôãÔ∏é‚ôåÔ∏é‚ôçÔ∏é‚ôéÔ∏é‚ôèÔ∏é‚ôêÔ∏é‚ôëÔ∏é‚ôíÔ∏é‚ôìÔ∏é",base11:"0123456789a",chessBase12:"‚ôö‚ôõ‚ôú‚ôù‚ôû‚ôü‚ôî‚ôï‚ôñ‚ôó‚ôò‚ôô",base16:"0123456789abcdef",dominoBase28:"üÅ£üÅ§üÅ´üÅ•üÅ¨üÅ≥üÅ¶üÅ≠üÅ¥üÅªüÅßüÅÆüÅµüÅºüÇÉüÅ®üÅØüÅ∂üÅΩüÇäüÇãüÅ©üÅ∞üÅ∑üÅæüÇÖüÇåüÇì",base32:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",zBase32:"ybndrfg8ejkmcpqxot1uwisza345h769",crock32:"0123456789ABCDEFGHJKMNPQRSTVWXYZ",base32Hex:"0123456789ABCDEFGHIJKLMNOPQRSTUV",base36:"0123456789abcdefghijklmnopqrstuvwxyz",mahjongBase43:"üÄëüÄíüÄìüÄîüÄïüÄñüÄóüÄòüÄôüÄöüÄõüÄúüÄùüÄûüÄüüÄ†üÄ°üÄáüÄàüÄâüÄäüÄãüÄåüÄçüÄéüÄèüÄÄüÄÅüÄÇüÄÉüÄÑÔ∏éüÄÖüÄÜüÄêüÄ¢üÄ£üÄ§üÄ•üÄ¶üÄßüÄ®üÄ©üÄ™",cards56:"üÇ°üÇ¢üÇ£üÇ§üÇ•üÇ¶üÇßüÇ®üÇ©üÇ™üÇ´üÇ¨üÇ≠üÇÆüÇ±üÇ≤üÇ≥üÇ¥üÇµüÇ∂üÇ∑üÇ∏üÇπüÇ∫üÇªüÇºüÇΩüÇæüÉÅüÉÇüÉÉüÉÑüÉÖüÉÜüÉáüÉàüÉâüÉäüÉãüÉåüÉçüÉéüÉëüÉíüÉìüÉîüÉïüÉñüÉóüÉòüÉôüÉùüÉû",base58:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ",flickrBase58:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ",base62:"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",base64:"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_@",cookieBase90:"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$%&'()*+-./:<=>?@[]^_`{|}~"},De=function(e){var t=0;return{generate:function(){return""+(e||"")+t++}}},Ge=function(e,t,r){void 0===e&&(e=Be.base64),void 0===t&&(t=21);var n=((e,t)=>((e,t,r)=>{let n=(2<<Math.log(e.length-1)/Math.LN2)-1,o=-~(1.6*n*t/e.length);return()=>{let i="";for(;;){let s=r(o),a=o;for(;a--;)if(i+=e[s[a]&n]||"",i.length===t)return i}}})(e,t,Re))(e,t);return{generate:function(){return r?r+n():n()}}},Ve={generator:"counter",alphabet:Be.base58,prefix:void 0},Me={__proto__:null,alphabets:Be,counterIDGenerator:De,gramIdentityPlugin:function(e){var t=qe({},Ve,e);return function(e){var r;switch(t.generator){case"nanoid":r=Ge(t.alphabet,21,t.prefix);break;case"counter":default:r=De(t.prefix)}Ie(e,(function(e){o(e)&&(e.id=e.id||r.generate())}))}},nanoidGenerator:Ge};function Fe(){return(Fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Ue(e){return(Ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ze(e,t){return(ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function He(e,t,r){return(He=Qe()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&ze(o,r.prototype),o}).apply(null,arguments)}function Je(e){var t="function"==typeof Map?new Map:void 0;return(Je=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return He(e,arguments,Ue(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ze(r,e)})(e)}var Ke={literalValueEvaluator:ot},Ze=/^([+-]\d{4,}\b|\d{4})$/,We=/^([0-9]{4})-(1[0-2]|0[1-9])$/,Ye=/^([0-9]{4})(-?)(1[0-2]|0[1-9])\2(3[01]|0[1-9]|[12][0-9])$/,Xe=/^(2[0-3]|[01][0-9]):?([0-5][0-9]):?([0-5][0-9](\.[0-9]{3})?)?(Z|([+-])((?:2[0-3]|[01][0-9]))(?::?([0-5][0-9]))?)?$/,et=/^P((\d+)Y)?((\d+)M)?((\d+)D)?(T((\d+)H)?((\d+)M)?((\d+)S)?)?$/,tt=function(e){var t,r;function n(t){var r;return(r=e.call(this,"AST is invalid:"+JSON.stringify(t))||this).name="InvalidAstError",r.ast=t,r}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n}(Je(Error)),rt=function e(t,r){return void 0===r&&(r=ot),n=t,Array.isArray(n)&&a(n[0])?t.map((function(t){return e(t)})):a(t)?r(t):function(e){return Array.isArray(e)&&!!(t=e[0]).type&&"property"===t.type;var t}(t)?t.reduce((function(t,r){return t[r.name]=e(r.value),t}),{}):void 0;var n};function nt(e){throw new Error("Unexpected object: "+e)}var ot=function(e){switch(e.type){case"boolean":return it(e);case"string":return st(e);case"integer":return ut(e);case"decimal":return ct(e);case"hexadecimal":return ft(e);case"octal":return pt(e);case"tagged":switch(e.tag){case"date":return at(e);case"time":return lt(e);case"datetime":case"interval":case"duration":return"TODO";case"uri":return e.value;case"wkt":return"TODO";default:nt(e)}case"measurement":return"measure by measure";default:return nt(e)}},it=function(e){return e.value&&"true"===e.value.toLowerCase()},st=function(e){if(e.value)return e.value;throw new tt(e)},at=function(e){if(e.value){var t=Ye.exec(e.value);if(t)return new Date(Date.UTC(Number.parseInt(t[1]),Number.parseInt(t[3])-1,Number.parseInt(t[4])));if(t=We.exec(e.value))return new Date(Date.UTC(Number.parseInt(t[1]),Number.parseInt(t[2])));if(t=Ze.exec(e.value))return new Date(Number.parseInt(t[1]),1);throw SyntaxError("Unable to parse date from "+e.value)}throw new tt(e)},lt=function(e){if(e.value){var t=Xe.exec(e.value);if(t){var r=Number.parseInt(t[1]),n=t[1]?Number.parseInt(t[2]):0,o=t[3]?Number.parseFloat(t[3]):0,i=t[5],s=36e5*r+6e4*n+1e3*o;if(i){var a="Z"===i?0:36e5*Number.parseInt(t[7])+6e4*Number.parseInt(t[8]||"0");return new Date("-"===t[6]?s+a:s-a)}return new Date(s)}throw SyntaxError("Unable to parse time from "+e.value)}throw new tt(e)},ut=function(e){if(e.value)return Number.parseInt(e.value);throw new tt(e)},ct=function(e){if(e.value)return Number.parseFloat(e.value);throw new tt(e)},ft=function(e){if(e.value)return Number.parseInt(e.value,16);throw new tt(e)},pt=function(e){if(e.value)return Number.parseInt(e.value,8);throw new tt(e)},ht={__proto__:null,gramValuePlugin:function(e){var t=Fe({},Ke,e);return function(e){Ie(e,(function(e){o(e)&&e.record&&(e.data=Object.assign(e.data||{},{value:rt(e.record,t.literalValueEvaluator)}))}))}},iso8601Duration:et,iso8601LocalTime:/^(2[0-3]|[01][0-9]):?([0-5][0-9])(:?([0-5][0-9](\.[0-9]{3})?))?$/,iso8601OrdinalDate:/^([0-9]{4})-?(36[0-6]|3[0-5][0-9]|[12][0-9]{2}|0[1-9][0-9]|00[1-9])$/,iso8601Repeat:/^R(\d*)$/,iso8601Time:Xe,iso8601WeekDate:/^([0-9]{4})-?W(5[0-3]|[1-4][0-9]|0[1-9])-?([1-7])$/,iso8601WeekOfYear:/^([0-9]{4})-?W(5[0-3]|[1-4][0-9]|0[1-9])$/,iso8601Year:Ze,iso8601YearMonth:We,iso8601YearMonthDay:Ye,valueOf:rt,valueOfBoolean:it,valueOfDate:at,valueOfDecimal:ct,valueOfDuration:function(e){if(e.value){var t=et.exec(e.value);if(t){var r=t[2]?Number.parseInt(t[2]):0,n=t[4]?Number.parseInt(t[4]):0,o=t[6]?Number.parseInt(t[6]):0,i=t[9]?Number.parseInt(t[9]):0,s=t[11]?Number.parseInt(t[11]):0,a=t[13]?Number.parseInt(t[13]):0;return new Date(31536e6*r+2592e6*n+864e5*o+36e5*i+6e4*s+1e3*a)}throw SyntaxError("Unable to parse duration from "+e.value)}throw new tt(e)},valueOfHexadecimal:ft,valueOfInteger:ut,valueOfLiteral:ot,valueOfMeasurement:function(e){if(e.value)return Number.parseInt(e.value);throw new tt(e)},valueOfOctal:pt,valueOfString:st,valueOfTaggedLiteral:function(e){if(e.value)return e.value;throw new tt(e)},valueOfTime:lt},dt=ve(Me),mt=ve(ht),yt=[dt.gramIdentityPlugin,mt.gramValuePlugin],bt={plugins:yt},gt={__proto__:null,default:bt,__moduleExports:bt,plugins:yt},vt=ae().use(_e).use(gt),wt=function(e){var t=vt.runSync(vt.parse(e));return{nodes:b(t).map(St),links:g(t).map(kt),paths:[]}},xt=function(e){return e.data&&e.data.value?e.data.value:e.record?e.record:{}},St=function(e){return s(e)?w(e.id,e.labels,xt(e)):w("random")},kt=function(e){return x(function(e){return"left"===e.kind?e.children[1].id||v:e.children[0].id||v}(e),function(e){return"left"===e.kind?e.children[0].id||v:e.children[1].id||v}(e),e.id,e.labels,xt(e))};e.MISSING_ID=v,e.d3Gram=wt,e.dataFromPath=xt,e.default=wt,e.edgeToD3=kt,e.isGramNodeDatum=function(e){return void 0!==e.id},e.makeGramLinkDatum=x,e.makeGramNodeDatum=w,e.nodeToD3=St,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=d3-gram.umd.production.min.js.map
